

- 修改了添加商品的菜单, 以便进行更多的选择, 并且方便了添加更多种类的商品

  ```cpp
  void doAddCommodity(CommodityManage& cm){
  	string name;
  	double price,discount;
  	double tariff;
  	int num;
  	char choois=commodityClassificationMenu ();
  	cout<<"输入商品名称:";
  	getline(cin,name);
  	cout<<"输入价格和商品数量:";
  	cin>>price>>num;
  	switch(choois){
  		case '0':
  			cout<<"输入商品折扣:";
  			cin>>discount;
  			cm.addCommodity(new
  							NormalCommodity(name,price,num,discount));
  			break;
  		case '1':
  			cout<<"输入商品折扣和关税:";
  			cin>>discount>>tariff;
  			cm.addCommodity(new
  							OverseaCommodity(name,price,num,discount,tariff));
  			break;
  		case '2':
  			cout<<"输入商品折扣和折旧程度: ";
  			double depreciation;
  			cin>>discount>>depreciation;
  			cm.addCommodity (new SecondHandCommodity
  							 (name, price, num, discount, depreciation));
  			break;
  		case '3':
  			cout<<"输入商品特价: ";
  			double specialPrice;
  			cin>>specialPrice;
  			cm.addCommodity (new BargainCommodity
  							 (name, price, num, specialPrice));
  			break;
  		default:
  			break;
  	}
  	return ;
  }
  ```

  其中调用子菜单get用户的选择

  并对非法输入做了较好的处理

  ```cpp
  char commodityClassificationMenu(void){
  	printf(
  				"选择商品类型:\n"
  				"%d) 普通商品\n"
  				"%d) 海外购商品\n"
  				"%d) 二手商品\n"
  				"%d) 特价商品\n"
  				,NORMAL, OVERSEA, SECONDHAND, BARGAIN);
  	char choois=0;
  	cin>>choois;
  	while(getchar()!='\n');			//清空缓冲区
  	while(choois<'0'||choois>BARGAIN+'0'){
  		cout<<"无效输入, 请重试!\n";
  		cin>>choois;
  		while(getchar()!='\n');		//清空缓冲区
  	}
  	return choois;
  }
  ```

  ___

  

- 添加了SecondHandCommodity子类表示二手商品

	继承与NormalCommodity

	```cpp
	class SecondHandCommodity: public NormalCommodity{
	public:
		virtual ~SecondHandCommodity() =default;
	
		SecondHandCommodity(long id, std::string name,
							double p=0, int n=0, double dis=1.0, double dep=0);
		SecondHandCommodity(std::string name,
							double p=0, int n=0, double dis=1.0, double dep=0);
	
		double getDepreciation(void) const{
			return depreciation;
		}
	
		void setDepreciation(double dep){
			this->depreciation=dep;
			return ;
		}
	
		virtual double getNetPrice()const;
		virtual void output()const;
		virtual int getType()const;
		virtual std::string getInfo()const;
	
	private:
		double depreciation;
	};
	```

	根据需要覆盖commodity中的4个虚函数:

	```cpp
		virtual double getNetPrice()const;
		virtual void output()const;
		virtual int getType()const=0; //纯虚函数
		virtual std::string getInfo()const;
	```

	```cpp
	double SecondHandCommodity::getNetPrice() const{
		return NormalCommodity::getNetPrice ()*this->depreciation;
	}
	
	void SecondHandCommodity::output() const{
		Commodity::output();
		cout<<" 商品总价:"<<getNetPrice()<<" (价格:"
		   <<getPrice()<<", 数量:"<<getNum()<<", 折扣:"
		  <<getDiscount ()<<", 商品折旧:"<<getDepreciation ()<<" )\n";
		return ;
	}
	
	int SecondHandCommodity::getType() const{
		return SECONDHAND;
	}
	
	string SecondHandCommodity::getInfo() const{
		ostringstream ostr;
		ostr<<SecondHandCommodity::getType ()<<" "; //先输出类型编码
		ostr<<Commodity::getInfo (); //输出基类的信息
		ostr<<getDiscount ()<<" "<<this->depreciation<<endl; //输出子类信息
		return ostr.str();
	}
	```

	给出虚析构函数与两种构造:

	实现中调用基类构造,. 并使用初始化列表

	___

	
	
- 添加了BargainCommodity表示特价商品:

	```cpp
	class BargainCommodity : public Commodity{
	public:
		virtual ~BargainCommodity() =default;
	
		BargainCommodity(long id,std::string name,double p=0,int nn=0, double sp=0);
		BargainCommodity(std::string name,double p=0,int nn=0, double sp=0);
	
		double getSpecialPrice(void) const{
			return this->specialPrice;
		}
	
		void setSpecialPrice(double sp){
			this->specialPrice=sp;
			return ;
		}
	
		virtual double getNetPrice()const;
		virtual void output()const;
		virtual int getType()const;
		virtual std::string getInfo()const;
	
	private:
		double specialPrice;
	};
	```

	具体实现如下:

	```cpp
	BargainCommodity::BargainCommodity
	(long id, std::string name, double p, int nn, double sp):
		Commodity(id,name, p, nn), specialPrice(sp) {}
	
	BargainCommodity::BargainCommodity
	(std::string name, double p, int nn, double sp):
		Commodity(name, p, nn), specialPrice(sp) {}
	
	double BargainCommodity::getNetPrice() const{
		return this->specialPrice*getNum ();
	}
	
	void BargainCommodity::output() const{
		Commodity::output ();
		cout<<" 商品总价:"<<getNetPrice()<<" (特价:"
		   <<getSpecialPrice ()<<", 数量:"<<getNum()<<" )\n";
		return ;
	}
	
	int BargainCommodity::getType() const{
		return BARGAIN;
	}
	
	std::string BargainCommodity::getInfo() const{
		ostringstream ostr;
		ostr<<BargainCommodity::getType ()<<" "; //先输出类型编码
		ostr<<Commodity::getInfo (); //输出基类的信息
		ostr<<this->specialPrice<<endl; //输出子类信息
		return ostr.str();
	}
	```

	大体思路和二手商品类似

	___

	

- 修改了读取文件的方式, 以适应添加的商品类型

	```cpp
	void CommodityManage::readData(string filename) {
		ifstream in(filename);
		if(in) {
			int fileMax,fileSize;
			long nextId;
			in>>fileMax>>fileSize>>nextId;
			Commodity::setNextId(nextId);
			int type;
			long id;
			string name,buf;
			double price,discount;
			double tariff;
			int num;
			for(int i=0; i<fileSize; ++i) {
				in>>type;
				in>>id;
				getline(in,buf);
				getline(in,name);
				in>>price>>num;
				switch(type) {
					case 0:
						in>>discount;
						addCommodity(new
										NormalCommodity(id,name,price,num,discount));
						break;
					case 1:
						in>>discount>>tariff;
						addCommodity(new
										OverseaCommodity(id,name,price,num,discount,tariff));
						break;
					case 2:
						double depreciation;
						in>>discount>>depreciation;
						addCommodity (new SecondHandCommodity
										 (id,name, price, num, discount, depreciation));
						break;
					case 3:
						double specialPrice;
						in>>specialPrice;
						addCommodity (new BargainCommodity
										 (id,name, price, num, specialPrice));
						break;
					default:
						break;
				}
			}
		}
	}
	```

	


​	